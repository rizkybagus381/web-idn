<!DOCTYPE html>
<html lang="en" class="lenis">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Selected Works</title>
    <!-- Link to PP Neue Montreal font -->
    <link href="https://fonts.cdnfonts.com/css/pp-neue-montreal" rel="stylesheet">
    <style>
        /* Define custom font from URL */
        @font-face {
            src: url("https://fonts.cdnfonts.com/css/pp-neue-montreal") format("woff2");
            font-family: "PP Neue Montreal", sans-serif;
            font-weight: 400;
        }

        /* Reset and basic box-sizing */
        *,
        *:before,
        *:after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Responsive font-size calculation based on viewport width */
        html {
            font-size: calc(100vw / 1512 * 10);
        }

        /* Lenis smooth scrolling styles */
        html.lenis {
            height: auto;
        }

        .lenis.lenis-smooth {
            scroll-behavior: auto;
        }

        .lenis.lenis-smooth [data-lenis-prevent] {
            overscroll-behavior: contain;
        }

        .lenis.lenis-stopped {
            overflow: hidden;
        }

        .lenis.lenis-scrolling iframe {
            pointer-events: none;
        }

        /* Define CSS variables for colors */
        :root {
            --warm-off-black: #1a1917;
            --warm-off-white: #f8f5f2;
        }

        /* Body styling */
        body {
            font-family: "PP Neue Montreal", sans-serif;
            font-weight: 700;
            font-size: 1.8rem;
            text-rendering: optimizeLegibility;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            overflow-x: hidden;
            background-color: var(--warm-off-black);
            text-transform: uppercase;
            letter-spacing: -0.03em;
            color: var(--warm-off-white);
            position: relative;
            margin: 0;
            padding: 0;
        }

        /* Animated noise effect for body background */
        body::before {
            content: "";
            position: fixed;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: transparent
            url("https://assets.iceable.com/img/noise-transparent.png") repeat 0 0;
            background-size: 300px 300px;
            animation: noise-animation 0.3s steps(5) infinite;
            opacity: 0.9;
            will-change: transform;
            z-index: 100;
            pointer-events: none;
        }

        /* Keyframes for noise animation */
        @keyframes noise-animation {
            0% {
                transform: translate(0, 0);
            }

            10% {
                transform: translate(-2%, -3%);
            }

            20% {
                transform: translate(-4%, 2%);
            }

            30% {
                transform: translate(2%, -4%);
            }

            40% {
                transform: translate(-2%, 5%);
            }

            50% {
                transform: translate(-4%, 2%);
            }

            60% {
                transform: translate(3%, 0);
            }

            70% {
                transform: translate(0, 3%);
            }

            80% {
                transform: translate(-3%, 0);
            }

            90% {
                transform: translate(2%, 2%);
            }

            100% {
                transform: translate(1%, 0);
            }
        }

        /* Dust/Scratches background effect for the entire site */
        body::after {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url("https://img.freepik.com/premium-photo/white-dust-scratches-black-background_279525-2.jpg?w=640");
            background-repeat: repeat;
            opacity: 0.5;
            mix-blend-mode: overlay;
            pointer-events: none;
            z-index: 999;
        }

        /* Site Header and Navigation */
        .site-header {
            padding: 1.5rem 0;
            width: 100%;
            z-index: 100;
            background-color: var(--warm-off-black);
            position: sticky; /* Make header sticky */
            top: 0; /* Stick to the top */
        }

        .site-header .grid-container {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 1rem;
            align-items: center;
            padding: 0 2rem;
        }

        .logo-container {
            grid-column: 1 / 3;
            position: relative;
            display: flex;
            align-items: center;
            height: 2rem;
        }

        /* Logo circles */
        .logo-circles {
            position: relative;
            width: 100%;
            height: 100%;
        }

        .circle {
            position: absolute;
            border-radius: 50%;
            transition: transform 0.5s cubic-bezier(0.445, 0.05, 0.55, 0.95);
            width: 1.8rem;
            height: 1.8rem;
            background-color: var(--warm-off-white); /* Same color for both circles */
            top: 50%;
        }

        .circle-1 {
            left: 0;
            transform: translate(0, -50%);
        }

        .circle-2 {
            left: 1rem;
            transform: translate(0, -50%);
            mix-blend-mode: exclusion;
        }

        .logo-container:hover .circle-1 {
            transform: translate(-0.5rem, -50%);
        }

        .logo-container:hover .circle-2 {
            transform: translate(0.5rem, -50%);
        }

        .main-nav {
            grid-column: 4 / 6;
        }

        .main-nav ul {
            display: flex;
            list-style: none;
            gap: 2rem;
        }

        .main-nav a {
            color: var(--warm-off-white);
            text-decoration: none;
            font-size: 1.4rem;
            transition: opacity 0.3s ease;
        }

        .main-nav a:not(.active) {
            opacity: 0.5;
        }

        .main-nav a:hover {
            opacity: 1;
        }

        .main-nav a.active {
            position: relative;
        }

        .main-nav a sup {
            font-size: 0.8rem;
            vertical-align: super;
        }

        .contact-link {
            grid-column: 9 / 13;
            text-align: right;
        }

        .contact-link a {
            color: var(--warm-off-white);
            text-decoration: none;
            font-size: 1.4rem;
            transition: opacity 0.3s ease;
        }

        .contact-link a:hover {
            opacity: 0.7;
        }

        /* 12-column grid layout for main content */
        .grid-container {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 1rem;
            padding: 0 2rem;
            width: 100%;
            max-width: 100%;
            min-height: 100%;
            height: auto;
        }

        .header {
            grid-column: 1 / -1;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4rem;
        }

        h1 {
            font-size: 4rem;
            text-transform: uppercase;
        }

        h1 sup {
            font-size: 2rem;
            vertical-align: super;
            margin-left: 0.5rem;
        }

        /* Header Logo */
        .header-logo {
            grid-column: 1 / -1;
            width: 100%;
            margin-bottom: 4rem;
            opacity: 0; /* Initially hidden, animated in */
            min-height: 60vh;
            max-height: 60vh;
            display: flex;
            align-items: flex-start;
        }

        .header-logo svg {
            width: 100%;
            height: auto;
        }

        /* Add this to ensure the logo paths are visible initially but clipped */
        .logo-path {
            clip-path: inset(100% 0 0 0); /* Initially hidden from bottom */
        }

        .projects-container {
            grid-column: 1 / -1;
            position: relative;
            min-height: 100vh;
            margin-bottom: 20vh;
        }

        .container {
            width: 100%;
            margin: 0 auto;
            padding: 0;
            height: 100%;
            overflow-y: auto;
        }

        .view-toggle {
            display: flex;
            gap: 2rem;
        }

        .toggle-btn {
            background: none;
            border: none;
            color: rgba(248, 245, 242, 0.5);
            padding: 0.8rem 0;
            font-family: inherit;
            font-size: 1.4rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .toggle-btn.active {
            color: var(--warm-off-white);
        }

        /* Project Item - Shared Styles */
        .project-item {
            position: relative;
            will-change: transform, opacity;
            overflow: visible;
            cursor: pointer;
            outline: none; /* Remove focus outline */
        }

        /* List View Styles */
        .projects-container.list-view {
            display: flex;
            flex-direction: column;
        }

        .list-view .project-item {
            display: flex;
            justify-content: space-between;
            padding: 2rem 0;
            border-bottom: 1px solid rgba(248, 245, 242, 0.1);
            position: relative;
            overflow: hidden;
        }

        /* List view hover animation with exclusion blend mode */
        .list-view .project-item::before {
            content: "";
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 0;
            background-color: var(--warm-off-white);
            z-index: 1;
            pointer-events: none;
            transition: height 0.2s cubic-bezier(0.445, 0.05, 0.55, 0.95) 0s;
        }

        .list-view .project-item:hover::before {
            height: 100%;
        }

        .list-view .project-item:not(:hover)::before {
            transition-duration: 0.8s;
        }

        .list-view .project-title,
        .list-view .project-year {
            font-size: 1.8rem;
            position: relative;
            z-index: 2;
            mix-blend-mode: exclusion;
        }

        /* In list view the image container is hidden by default */
        .list-view .project-image-container {
            display: none;
            visibility: hidden;
        }

        /* When transitioning (grid -> list) we briefly show it */
        .list-view .project-image-container.transitioning-to-list {
            display: block !important;
            visibility: visible !important;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }

        .list-view .project-image-container.transitioning-to-list .project-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Grid View Styles */
        .projects-container.grid-view {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 2rem;
        }

        .grid-view .project-item {
            display: flex;
            flex-direction: column;
        }

        .grid-view .project-image-container {
            width: 100%;
            position: relative;
            margin-bottom: 1rem;
            display: block;
            overflow: hidden;
            border-radius: 0.5rem; /* Added rounded corners for grid images */
        }

        /* Alternating image heights for visual variety in grid view */
        .grid-view .project-item:nth-child(odd) .project-image-container {
            aspect-ratio: 1 / 1;
        }

        .grid-view .project-item:nth-child(even) .project-image-container {
            aspect-ratio: 1 / 1.5;
        }

        .grid-view .project-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            position: absolute;
            top: 0;
            left: 0;
        }

        .grid-view .project-title {
            font-size: 1.6rem;
            margin-bottom: 0.2rem;
        }

        .grid-view .project-year {
            font-size: 1.4rem;
            color: rgba(248, 245, 242, 0.7);
        }

        /* Popup Overlay for Image Preview */
        #popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(26, 25, 23, 0.9); /* Dark overlay */
            display: none; /* Hidden by default */
            align-items: center;
            justify-content: center;
            z-index: 1000;
            pointer-events: none; /* Allow interaction with elements behind it initially */
            opacity: 0; /* Start hidden for animation */
        }

        #popup-overlay.active {
            pointer-events: auto; /* Enable interaction when active */
        }

        #popup-overlay .popup-content {
            width: 80vw;
            max-width: 1280px;
            aspect-ratio: 16 / 9; /* Maintain aspect ratio */
            background: var(--warm-off-black);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
            border-radius: 0.5rem; /* Rounded corners for popup image */
        }

        #popup-overlay .popup-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0; /* Start hidden for animation */
        }

        /* Footer Styles */
        .footer {
            background-color: var(--warm-off-white);
            color: var(--warm-off-black);
            padding: 8rem 2rem;
            min-height: 75vh;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            position: relative;
        }

        .footer-content {
            width: 100%;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        .footer-header {
            margin-bottom: 8rem;
        }

        .footer-header h2 {
            font-size: 4.5rem;
            line-height: 1.1;
            letter-spacing: -0.03em;
            text-transform: none;
        }

        .light-text {
            display: block;
            font-weight: 400;
            opacity: 0.7;
        }

        .bold-text {
            display: block;
            font-weight: 700;
        }

        .footer-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 4rem;
            margin-bottom: 10rem;
        }

        .footer-column {
            display: flex;
            flex-direction: column;
            gap: 6rem;
        }

        .footer-section h3 {
            font-size: 1.4rem;
            margin-bottom: 1rem;
            opacity: 0.6;
            font-weight: 400;
            text-transform: none;
        }

        .footer-section p {
            font-size: 1.6rem;
            margin-bottom: 0.5rem;
            text-transform: none;
        }

        /* Footer links styling */
        .footer-section a {
            color: var(--warm-off-black);
            text-decoration: none;
            transition: opacity 0.3s ease;
        }

        .footer-section a:hover {
            opacity: 0.7;
        }

        .footer-logo {
            width: 100%;
            margin-top: 4rem;
            opacity: 0; /* Initially hidden, animated in */
        }

        .footer-logo svg {
            width: 100%;
            height: auto;
        }

        /* Responsive Styles */
        @media (max-width: 1200px) {
            .projects-container.grid-view {
                grid-template-columns: repeat(3, 1fr);
            }

            .footer-header h2 {
                font-size: 3.5rem;
            }

            .main-nav {
                grid-column: 4 / 8;
            }

            .contact-link {
                grid-column: 8 / 13;
            }
        }

        @media (max-width: 768px) {
            .projects-container.grid-view {
                grid-template-columns: repeat(2, 1fr);
            }

            .header {
                flex-direction: column;
                align-items: flex-start;
                gap: 2rem;
            }

            .footer-grid {
                grid-template-columns: 1fr;
                gap: 4rem;
            }

            .footer-header h2 {
                font-size: 3rem;
            }

            .site-header .grid-container {
                grid-template-columns: 1fr;
                gap: 2rem;
            }

            .logo-container {
                grid-column: 1 / -1;
            }

            .main-nav {
                grid-column: 1 / -1;
            }

            .contact-link {
                grid-column: 1 / -1;
                text-align: left;
            }

            .main-nav ul {
                flex-direction: column;
                gap: 1rem;
            }
        }

        @media (max-width: 480px) {
            .projects-container.grid-view {
                grid-template-columns: 1fr;
            }

            .footer-header h2 {
                font-size: 2.5rem;
            }
        }
    </style>
</head>
<body>
<!-- Header and Navigation -->
<header class="site-header">
    <div class="grid-container">
        <!-- Logo with circles only -->
        <div class="logo-container">
            <div class="logo-circles">
                <div class="circle circle-1"></div>
                <div class="circle circle-2"></div>
            </div>
        </div>

        <nav class="main-nav">
            <ul>
                <li><a href="#" class="active">SELECTED WORKS<sup>10</sup></a></li>
                <li><a href="#">ABOUT</a></li>
                <li><a href="#">JOURNAL</a></li>
            </ul>
        </nav>

        <div class="contact-link">
            <a href="mailto:hi@filip.fyi">+GET IN TOUCH</a>
        </div>
    </div>
</header>

<div class="container">
    <div class="grid-container">
        <!-- Header Logo -->
        <div class="header-logo">
            <svg viewBox="0 0 67 19" xmlns="http://www.w3.org/2000/svg">
                <g fill="var(--warm-off-white)">
                    <path class="logo-path"
                          d="m56.7888 18c0-5.304 2.256-10.72798 5.208-13.24798v-.048h-7.848v-3.288h12.168v3.048c-3.768 3.048-5.208 8.42398-5.208 13.53598z"/>
                    <path class="logo-path"
                          d="m39.4973 18v-17.159973h8.088c3.816 0 6.12 1.776003 6.12 4.896003 0 2.4-1.344 3.816-3.48 4.29597v.048c4.296.744 2.736 7.392 3.72 7.68v.24h-4.488c-.84-.72.72-5.976-2.952-5.976h-2.688v5.976zm4.32-9.50397h2.928c1.728 0 2.64-.624 2.64-2.064s-.912-2.064-2.64-2.064h-2.928z"/>
                    <path class="logo-path" d="m33.022 18v-17.159973h4.32v17.159973z"/>
                    <path class="logo-path"
                          d="m24.173 18.384c-4.968 0-7.296-3.72-7.296-8.66402 0-4.944 2.328-8.688 7.296-8.688s7.272 3.744 7.272 8.688c0 4.94402-2.304 8.66402-7.272 8.66402zm-3.048-8.66402c0 3.00002.672 5.30402 3.048 5.30402s3.024-2.304 3.024-5.30402c0-3-.648-5.328-3.048-5.328s-3.048 2.328-3.048 5.328z"/>
                    <path class="logo-path"
                          d="m.594849 18v-17.159973h4.320001l5.99995 10.199973h.048v-10.199973h4.3201v17.159973h-4.3201l-5.99995-10.19997h-.048v10.19997z"/>
                </g>
            </svg>
        </div>

        <div class="header">
            <div class="header-title">
                <h1>SELECTED WORKS<sup>10</sup></h1>
            </div>
            <div class="view-toggle">
                <button class="toggle-btn active" data-view="list">List</button>
                <button class="toggle-btn" data-view="grid">Grid</button>
            </div>
        </div>

        <div id="projects-container" class="projects-container list-view"></div>
    </div>
</div>

<!-- Popup Overlay for Image Preview -->
<div id="popup-overlay">
    <div class="popup-content">
        <img class="popup-image" src="https://placehold.co/1280x720/000000/FFFFFF?text=Placeholder" alt="Popup Image">
    </div>
</div>

<!-- Footer Section -->
<footer class="footer">
    <div class="footer-content">
        <div class="footer-header">
            <h2>
                <span class="light-text">Find the essence in simplicity,</span>
                <span class="bold-text">Create without boundaries.</span>
            </h2>
        </div>

        <div class="footer-grid">
            <div class="footer-column">
                <div class="footer-section">
                    <h3>Contact</h3>
                    <p><a href="mailto:hi@filip.fyi">hi@filip.fyi</a></p>
                    <p><a href="tel:+381631943959">+381.63.TARA.959</a></p>
                </div>

                <div class="footer-section">
                    <h3>&nbsp;</h3>
                    <p>&nbsp;</p>
                </div>
            </div>

            <div class="footer-column">
                <div class="footer-section">
                    <p><a href="#">Sound</a></p>
                    <p><a href="#">Vision</a></p>
                    <p><a href="#">Feeling</a></p>
                </div>

                <div class="footer-section">
                    <h3>Fragments</h3>
                    <p>Receive Signals</p>
                </div>
            </div>

            <div class="footer-column">
                <div class="footer-section">
                    <p><a href="#">Works<sup>(10)</sup></a></p>
                    <p><a href="#">About</a></p>
                    <p><a href="#">Journal</a></p>
                </div>

                <div class="footer-section">
                    <h3>Location</h3>
                    <p>43.9359° N, 19.4959° E</p>
                </div>
            </div>
        </div>

        <!-- Footer Logo -->
        <div class="footer-logo">
            <svg viewBox="0 0 67 19" xmlns="http://www.w3.org/2000/svg">
                <g fill="var(--warm-off-black)">
                    <path class="logo-path"
                          d="m56.7888 18c0-5.304 2.256-10.72798 5.208-13.24798v-.048h-7.848v-3.288h12.168v3.048c-3.768 3.048-5.208 8.42398-5.208 13.53598z"/>
                    <path class="logo-path"
                          d="m39.4973 18v-17.159973h8.088c3.816 0 6.12 1.776003 6.12 4.896003 0 2.4-1.344 3.816-3.48 4.29597v.048c4.296.744 2.736 7.392 3.72 7.68v.24h-4.488c-.84-.72.72-5.976-2.952-5.976h-2.688v5.976zm4.32-9.50397h2.928c1.728 0 2.64-.624 2.64-2.064s-.912-2.064-2.64-2.064h-2.928z"/>
                    <path class="logo-path" d="m33.022 18v-17.159973h4.32v17.159973z"/>
                    <path class="logo-path"
                          d="m24.173 18.384c-4.968 0-7.296-3.72-7.296-8.66402 0-4.944 2.328-8.688 7.296-8.688s7.272 3.744 7.272 8.688c0 4.94402-2.304 8.66402-7.272 8.66402zm-3.048-8.66402c0 3.00002.672 5.30402 3.048 5.30402s3.024-2.304 3.024-5.30402c0-3-.648-5.328-3.048-5.328s-3.048 2.328-3.048 5.328z"/>
                    <path class="logo-path"
                          d="m.594849 18v-17.159973h4.320001l5.99995 10.199973h.048v-10.199973h4.3201v17.159973h-4.3201l-5.99995-10.19997h-.048v10.19997z"/>
                </g>
            </svg>
        </div>
    </div>
</footer>

<!-- GSAP and its plugins -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/Flip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/ScrollTrigger.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/CustomEase.min.js"></script>
<!-- Lenis for smooth scrolling -->
<script src="https://unpkg.com/@studio-freight/lenis@1.0.39/dist/lenis.min.js"></script>

<script>
    // Project data with minimalist titles and image URLs
    const projects = [
        {
            id: 1,
            title: "Silence",
            year: "2021",
            image: "https://cdn.cosmos.so/7d47d4e2-0eff-4e2f-9734-9d24a8ba067e?format=jpeg"
        },
        {
            id: 2,
            title: "Resonance",
            year: "2022",
            image: "https://cdn.cosmos.so/5eee2d2d-3d4d-4ae5-96d4-cdbae70a2387?format=jpeg"
        },
        {
            id: 3,
            title: "Essence",
            year: "2022",
            image: "https://cdn.cosmos.so/def30e8a-34b2-48b1-86e1-07ec5c28f225?format=jpeg"
        },
        {
            id: 4,
            title: "Void",
            year: "2023",
            image: "https://cdn.cosmos.so/44d7cb23-6759-49e4-9dc1-acf771b3a0d1?format=jpeg"
        },
        {
            id: 5,
            title: "Presence",
            year: "2023",
            image: "https://cdn.cosmos.so/7712fe42-42ca-4fc5-9590-c89f2db99978?format=jpeg"
        },
        {
            id: 6,
            title: "Flow",
            year: "2024",
            image: "https://cdn.cosmos.so/cbee1ec5-01b6-4ffe-9f34-7da7980454cf?format=jpeg"
        },
        {
            id: 7,
            title: "Clarity",
            year: "2024",
            image: "https://cdn.cosmos.so/2e91a9d1-db85-4499-ad37-6222a6fea23b?format=jpeg"
        },
        {
            id: 8,
            title: "Breath",
            year: "2024",
            image: "https://cdn.cosmos.so/ff2ac3d3-fa94-4811-89f6-0d008b27e439?format=jpeg"
        },
        {
            id: 9,
            title: "Stillness",
            year: "2025",
            image: "https://cdn.cosmos.so/c39a4043-f489-4406-8018-a103a3f89802?format=jpeg"
        },
        {
            id: 10,
            title: "Surrender",
            year: "2025",
            image: "https://cdn.cosmos.so/e5e399f2-4050-463b-a781-4f5a1615f28e?format=jpeg"
        }
    ];

    // Global variables
    let projectsContainer;
    let toggleButtons;
    let popupOverlay, popupImage;
    let popupHideTimeout = null;
    let popupShowTimeout = null;
    let currentHoveredItem = null;
    let isPopupVisible = false;
    let lastMouseMoveTime = 0;
    let lastInteractionTime = 0;
    let mouseOverImageContainer = false;
    const debounceDelay = 50; // Debounce delay in ms
    let isMouseDown = false; // Track mouse button state

    let currentView = "list"; // Default view
    let isAnimating = false; // Flag to prevent multiple animations
    let lenis; // Lenis smooth scroll instance

    // Wait for the DOM to be fully loaded before initializing
    document.addEventListener("DOMContentLoaded", function () {
        // Get DOM elements
        projectsContainer = document.getElementById("projects-container");
        toggleButtons = document.querySelectorAll(".toggle-btn");
        popupOverlay = document.getElementById("popup-overlay");
        popupImage = popupOverlay.querySelector(".popup-image");

        // Initialize GSAP plugins
        const {gsap} = window;

        // Check if GSAP plugins are available before using them
        if (gsap) {
            if (gsap.registerPlugin) {
                if (window.Flip) gsap.registerPlugin(window.Flip);
                if (window.ScrollTrigger) gsap.registerPlugin(window.ScrollTrigger);
                if (window.CustomEase) {
                    gsap.registerPlugin(window.CustomEase);
                    // Only create custom ease if the plugin is available
                    window.CustomEase.create("customEase", "0.6, 0.01, 0.05, 1");
                }
            }
        }

        // Initialize Lenis for smooth scrolling
        initLenis();

        // Render project items initially
        renderProjects();
        // Attach hover events based on current view
        attachHoverEvents();
        // Setup global mouse and scroll event listeners
        setupGlobalEvents();
        // Setup header and footer logo animations
        setupLogoAnimations();
        setupFooterAnimation();

        // Pre-load images to ensure smooth transitions
        forceImageLoad();
        // Run initial animation for project items
        initialAnimation();

        // Add event listeners to toggle buttons
        toggleButtons.forEach((btn) => {
            btn.addEventListener("click", () => {
                const viewType = btn.dataset.view;
                toggleView(viewType);
            });
        });
    });

    /**
     * Initializes Lenis for smooth scrolling.
     * Sets up the Lenis instance and integrates it with GSAP's ScrollTrigger.
     */
    function initLenis() {
        // Initialize a new Lenis instance for smooth scrolling
        lenis = new Lenis({
            duration: 1.2,
            easing: (t) => Math.min(1, 1.001 - Math.pow(2, -10 * t)), // Exponential easing
            direction: "vertical",
            gestureDirection: "vertical",
            smooth: true,
            mouseMultiplier: 1,
            smoothTouch: false,
            touchMultiplier: 2,
            infinite: false
        });

        // Synchronize Lenis scrolling with GSAP's ScrollTrigger plugin
        lenis.on("scroll", ScrollTrigger.update);

        // Add Lenis's requestAnimationFrame (raf) method to GSAP's ticker
        // This ensures Lenis's smooth scroll animation updates on each GSAP tick
        gsap.ticker.add((time) => {
            lenis.raf(time * 1000); // Convert time from seconds to milliseconds
        });

        // Disable lag smoothing in GSAP to prevent any delay in scroll animations
        gsap.ticker.lagSmoothing(0);
    }

    /**
     * Sets up animations for the header logo using GSAP.
     * Animates the clip-path property of SVG paths to reveal the logo.
     */
    function setupLogoAnimations() {
        const {gsap} = window;
        if (!gsap) return;

        // Select all logo paths within the header logo
        const headerLogoPaths = document.querySelectorAll(".header-logo .logo-path");

        // Make the header logo container visible (it's initially opacity 0 in CSS)
        gsap.to(".header-logo", {
            opacity: 1,
            duration: 0.5,
            ease: "power2.out"
        });

        // Set initial state for each path - hidden from the bottom using clipPath
        gsap.set(headerLogoPaths, {
            clipPath: "inset(100% 0 0 0)", // Hide from bottom
            opacity: 1 // Ensure full opacity during reveal
        });

        // Animate each path to reveal from bottom with a stagger effect
        gsap.to(headerLogoPaths, {
            clipPath: "inset(0% 0 0 0)", // Reveal fully
            duration: 1.2,
            ease: "power2.out",
            stagger: 0.15, // Delay between each path's animation
            delay: 0.3 // Overall delay before animation starts
        });
    }

    /**
     * Sets up animations for the footer sections and logo using GSAP ScrollTrigger.
     * Elements animate into view as they enter the viewport.
     */
    function setupFooterAnimation() {
        const {gsap} = window;
        const ScrollTrigger = window.ScrollTrigger;
        if (!gsap || !ScrollTrigger) return;

        // Ensure footer logo is visible (it's initially opacity 0 in CSS)
        gsap.set(".footer-logo", {opacity: 1});

        // Select all logo paths within the footer logo
        const footerLogoPaths = document.querySelectorAll(".footer-logo .logo-path");

        // Set initial state for each path - hidden from the bottom using clipPath
        gsap.set(footerLogoPaths, {
            clipPath: "inset(100% 0 0 0)", // Hide from bottom
            opacity: 1 // Ensure full opacity during reveal
        });

        // Create ScrollTrigger for footer logo animation
        ScrollTrigger.create({
            trigger: ".footer-logo",
            start: "top 80%", // When the top of the footer logo enters 80% down the viewport
            onEnter: () => {
                // Animate each path to reveal from bottom with a stagger effect
                gsap.to(footerLogoPaths, {
                    clipPath: "inset(0% 0 0 0)", // Reveal fully
                    duration: 1.2,
                    ease: "power2.out",
                    stagger: 0.15
                });
            },
            once: true // Only animate once
        });

        // Animate footer sections using ScrollTrigger.batch for staggered animations
        ScrollTrigger.batch(".footer-section", {
            start: "top 90%", // When the top of each section enters 90% down the viewport
            onEnter: (batch) => {
                gsap.from(batch, {
                    opacity: 0,
                    y: 30, // Move up from 30px below
                    stagger: 0.1, // Stagger delay between sections
                    duration: 0.8,
                    ease: "power2.out"
                });
            },
            once: true // Only animate once per batch
        });

        // Animate footer header text
        ScrollTrigger.create({
            trigger: ".footer-header",
            start: "top 85%", // When the top of the footer header enters 85% down the viewport
            onEnter: () => {
                // Animate the light text
                gsap.from(".light-text", {
                    opacity: 0,
                    y: 20, // Move up from 20px below
                    duration: 0.8,
                    ease: "power2.out"
                });

                // Animate the bold text with a slight delay
                gsap.from(".bold-text", {
                    opacity: 0,
                    y: 20,
                    duration: 0.8,
                    delay: 0.2,
                    ease: "power2.out"
                });
            },
            once: true // Only animate once
        });
    }

    /**
     * Debounce function to limit how often a function can run.
     * Useful for events that fire rapidly like mousemove or scroll.
     * @param {Function} func The function to debounce.
     * @param {number} delay The delay in milliseconds.
     * @returns {Function} The debounced function.
     */
    function debounce(func, delay) {
        let timeout;
        return function (...args) {
            clearTimeout(timeout);
            timeout = setTimeout(() => func.apply(this, args), delay);
        };
    }

    /**
     * Sets up global event listeners for mouse movement and scrolling.
     * These events are used to track user interaction and manage the popup display.
     */
    function setupGlobalEvents() {
        // Global mousemove event to track current hovered item (with debounce)
        document.addEventListener("mousemove", handleGlobalMouseMove);

        // Add scroll event listener to update popup when scrolling (with debounce)
        document.addEventListener("scroll", debounce(handleScroll, debounceDelay), {
            passive: true // Improves performance for scroll events
        });

        // Track mouse button state (useful for preventing popup hide during drag/selection)
        document.addEventListener("mousedown", () => {
            isMouseDown = true;
        });
        document.addEventListener("mouseup", () => {
            isMouseDown = false;
        });

        // Add a global mouseout event to handle cases where the mouse leaves the document
        document.addEventListener("mouseout", (e) => {
            // If mouse leaves the entire document
            if (e.relatedTarget === null || e.relatedTarget.nodeName === "HTML") {
                hidePopup();
                mouseOverImageContainer = false;
                currentHoveredItem = null;
            }
        });
    }

    /**
     * Handles global mouse movement events.
     * Dispatches to specific handlers based on the current view (list or grid).
     * @param {MouseEvent} e The mouse event object.
     */
    function handleGlobalMouseMove(e) {
        lastMouseMoveTime = Date.now();
        lastInteractionTime = Date.now();

        if (currentView === "grid") {
            handleGridViewMouseMove(e);
        } else if (currentView === "list") {
            handleListViewMouseMove(e);
        }
    }

    /**
     * Handles mouse movement specifically for the grid view.
     * Checks if the mouse is over any project image container and updates the popup accordingly.
     * @param {MouseEvent} e The mouse event object.
     */
    function handleGridViewMouseMove(e) {
        // For grid view, check if mouse is over any image container
        const imageContainers = document.querySelectorAll(
            ".grid-view .project-image-container"
        );
        let foundContainer = null;

        // Iterate through containers to find if mouse is over one
        imageContainers.forEach((container) => {
            const rect = container.getBoundingClientRect();
            if (
                e.clientX >= rect.left &&
                e.clientX <= rect.right &&
                e.clientY >= rect.top &&
                e.clientY <= rect.bottom
            ) {
                foundContainer = container;
            }
        });

        if (foundContainer) {
            // Mouse is over an image container
            mouseOverImageContainer = true;
            // Clear any pending hide timeout if moving over a new container
            if (popupHideTimeout) {
                clearTimeout(popupHideTimeout);
                popupHideTimeout = null;
            }

            const projectItem = foundContainer.closest(".project-item");
            // If the hovered item has changed, update the popup
            if (projectItem !== currentHoveredItem) {
                currentHoveredItem = projectItem;
                updatePopupFromItem(projectItem);
            }
        } else {
            // Mouse is not over any image container
            mouseOverImageContainer = false;

            // Only start the hide timeout if the popup is visible
            if (isPopupVisible) {
                if (popupHideTimeout) clearTimeout(popupHideTimeout);
                popupHideTimeout = setTimeout(() => {
                    // Double check if we've moved to another container in the meantime
                    if (!mouseOverImageContainer) {
                        hidePopup();
                        currentHoveredItem = null; // Reset current hovered item
                    }
                }, 150); // Short delay to allow moving between adjacent containers
            }
        }
    }

    /**
     * Handles mouse movement specifically for the list view.
     * Checks if the mouse is over any project item and updates the popup accordingly.
     * @param {MouseEvent} e The mouse event object.
     */
    function handleListViewMouseMove(e) {
        // For list view, check if mouse is over any project item
        const projectItems = document.querySelectorAll(".list-view .project-item");
        let foundItem = null;

        // Iterate through items to find if mouse is over one
        projectItems.forEach((item) => {
            const rect = item.getBoundingClientRect();
            // Add a small buffer (2px) to improve detection reliability at edges
            if (
                e.clientX >= rect.left - 2 &&
                e.clientX <= rect.right + 2 &&
                e.clientY >= rect.top - 2 &&
                e.clientY <= rect.bottom + 2
            ) {
                foundItem = item;
            }
        });

        if (foundItem) {
            if (foundItem !== currentHoveredItem) {
                currentHoveredItem = foundItem;

                // Clear any pending hide timeout
                if (popupHideTimeout) {
                    clearTimeout(popupHideTimeout);
                    popupHideTimeout = null;
                }

                // Use a short delay before showing to prevent flickering when moving quickly
                if (popupShowTimeout) clearTimeout(popupShowTimeout);
                popupShowTimeout = setTimeout(() => {
                    updatePopupFromItem(foundItem);
                }, 10);
            }
        } else {
            // Only hide if we're actually outside all items and not just moving between them
            if (popupHideTimeout) clearTimeout(popupHideTimeout);
            popupHideTimeout = setTimeout(() => {
                hidePopup();
                currentHoveredItem = null; // Reset current hovered item
            }, 150); // Small delay before hiding
        }
    }

    /**
     * Handles scroll events to update the displayed image in the popup.
     * It finds the project item closest to the viewport center and displays its image.
     */
    function handleScroll() {
        if (!isPopupVisible) return; // Only update if popup is currently visible

        // Determine which set of containers to check based on current view
        const containers =
            currentView === "grid"
                ? document.querySelectorAll(".project-image-container")
                : document.querySelectorAll(".project-item");

        const viewportHeight = window.innerHeight;
        const viewportCenter = viewportHeight / 2;

        let closestContainer = null;
        let closestDistance = Infinity;

        // Find the container closest to the viewport's center
        containers.forEach((container) => {
            const rect = container.getBoundingClientRect();
            const itemCenter = rect.top + rect.height / 2;
            const distance = Math.abs(itemCenter - viewportCenter);

            // Only consider items that are at least partially in view
            if (
                distance < closestDistance &&
                rect.top < viewportHeight &&
                rect.bottom > 0
            ) {
                closestDistance = distance;
                closestContainer = container;
            }
        });

        // If a closest container is found and it's different from the currently hovered one, update the popup
        if (closestContainer) {
            const projectItem = closestContainer.closest(".project-item");
            if (projectItem !== currentHoveredItem) {
                currentHoveredItem = projectItem;
                updatePopupFromItem(projectItem);
            }
        } else {
            // If no project item is visible, hide the popup
            hidePopup();
            currentHoveredItem = null;
        }
    }

    /**
     * Updates the popup with the image from the given project item.
     * @param {HTMLElement} item The project item element.
     */
    function updatePopupFromItem(item) {
        if (!item) return;

        const projectId = item.dataset.id;
        const project = projects.find((p) => p.id == projectId); // Find project data by ID

        if (project) {
            showPopup(project.image); // Show popup with the project's image
        }
    }

    /**
     * Pre-loads all project images to prevent flickering during transitions.
     * This function creates new Image objects and sets their source, then assigns them to DOM elements.
     */
    function forceImageLoad() {
        projects.forEach((project) => {
            const img = new Image();
            img.crossOrigin = "anonymous"; // Essential for CORS if images are from a different domain
            img.onload = function () {
                // Once loaded, assign the loaded image source to the actual DOM image element
                const domImg = document.querySelector(
                    `.project-item[data-id="${project.id}"] .project-image`
                );
                if (domImg) domImg.src = this.src;
            };
            img.src = project.image; // Start loading the image
        });
    }

    /**
     * Animates the initial appearance of project items on page load.
     * Uses GSAP to fade in and slide up elements.
     */
    function initialAnimation() {
        const {gsap} = window;
        if (!gsap) return;

        // Set initial state of project items to hidden and slightly below their final position
        gsap.set(".project-item", {opacity: 0, y: 30});
        // Animate project items to their visible state with a stagger effect
        gsap.to(".project-item", {
            opacity: 1,
            y: 0,
            duration: 0.8,
            ease: "power2.out",
            stagger: {each: 0.08, from: "start"} // Stagger animation for each item
        });
    }

    /**
     * Renders project items into the DOM based on the `projects` array.
     * Each project creates a `div.project-item` with an image, title, and year.
     */
    function renderProjects() {
        projectsContainer.innerHTML = ""; // Clear existing content
        projects.forEach((project) => {
            const projectItem = document.createElement("div");
            projectItem.classList.add("project-item");
            projectItem.dataset.id = project.id; // Store project ID for easy lookup
            projectItem.innerHTML = `
                <div class="project-image-container">
                    <img class="project-image" src="${project.image}" alt="${project.title}" crossorigin="anonymous" onerror="this.onerror=null;this.src='https://placehold.co/600x400/000000/FFFFFF?text=Image+Not+Found';">
                </div>
                <div class="project-title">${project.title}</div>
                <div class="project-year">${project.year}</div>
            `;
            projectsContainer.appendChild(projectItem);
        });
    }

    /**
     * Attaches `mouseenter` and `mouseleave` event listeners to project items
     * or image containers based on the current view mode (list or grid).
     */
    function attachHoverEvents() {
        // Remove any existing event listeners first to prevent duplicates
        removeAllHoverEvents();

        // For list view, attach to the entire project item
        if (currentView === "list") {
            const projectItems = document.querySelectorAll(".list-view .project-item");
            projectItems.forEach((item) => {
                item.dataset.hovered = "false"; // Initialize hover state
                item.addEventListener("mouseenter", listItemMouseEnter);
                item.addEventListener("mouseleave", listItemMouseLeave);
            });
        }

        // For grid view, attach to image containers ONLY
        if (currentView === "grid") {
            const imageContainers = document.querySelectorAll(
                ".grid-view .project-image-container"
            );
            imageContainers.forEach((container) => {
                container.dataset.hovered = "false"; // Initialize hover state
                container.addEventListener("mouseenter", gridContainerMouseEnter);
                container.addEventListener("mouseleave", gridContainerMouseLeave);
            });
        }
    }

    /**
     * Removes all previously attached hover event listeners from project items and image containers.
     * This is crucial before re-attaching new listeners during view transitions.
     */
    function removeAllHoverEvents() {
        const projectItems = document.querySelectorAll(".project-item");
        projectItems.forEach((item) => {
            item.removeEventListener("mouseenter", listItemMouseEnter);
            item.removeEventListener("mouseleave", listItemMouseLeave);
        });

        const imageContainers = document.querySelectorAll(".project-image-container");
        imageContainers.forEach((container) => {
            container.removeEventListener("mouseenter", gridContainerMouseEnter);
            container.removeEventListener("mouseleave", gridContainerMouseLeave);
        });
    }

    /**
     * Handles `mouseenter` event for list view project items.
     * Manages popup display by clearing hide timeouts and setting current hovered item.
     */
    function listItemMouseEnter() {
        if (currentView !== "list") return; // Only process if in list view

        this.dataset.hovered = "true"; // Mark item as hovered
        if (popupHideTimeout) {
            clearTimeout(popupHideTimeout);
            popupHideTimeout = null;
        }
        currentHoveredItem = this;

        // Small delay to prevent flickering if mouse quickly passes over
        setTimeout(() => {
            // Only show if still hovering after the delay
            if (this.dataset.hovered === "true") {
                const projectId = this.dataset.id;
                const project = projects.find((p) => p.id == projectId);
                if (project) {
                    showPopup(project.image);
                }
            }
        }, 10);
    }

    /**
     * Handles `mouseleave` event for list view project items.
     * Initiates a timeout to hide the popup if no other item is hovered.
     */
    function listItemMouseLeave() {
        if (currentView !== "list") return; // Only process if in list view

        this.dataset.hovered = "false"; // Mark item as no longer hovered

        // Don't hide immediately, give time to move to another item
        if (popupHideTimeout) clearTimeout(popupHideTimeout);
        popupHideTimeout = setTimeout(() => {
            // Check if ANY list item is still hovered before hiding the popup
            const anyHovered = Array.from(
                document.querySelectorAll(".list-view .project-item")
            ).some((p) => p.dataset.hovered === "true");
            if (!anyHovered) {
                hidePopup();
                currentHoveredItem = null; // Reset current hovered item
            }
        }, 150);
    }

    /**
     * Handles `mouseenter` event for grid view image containers.
     * Manages popup display by clearing hide timeouts and setting current hovered item.
     */
    function gridContainerMouseEnter() {
        if (currentView !== "grid") return; // Only process if in grid view

        this.dataset.hovered = "true"; // Mark container as hovered
        mouseOverImageContainer = true;
        if (popupHideTimeout) {
            clearTimeout(popupHideTimeout);
            popupHideTimeout = null;
        }

        const projectItem = this.closest(".project-item");
        currentHoveredItem = projectItem;

        // Small delay to prevent flickering
        setTimeout(() => {
            // Only show if still hovering after the delay
            if (this.dataset.hovered === "true") {
                const img = this.querySelector(".project-image");
                if (img && img.src) {
                    showPopup(img.src);
                }
            }
        }, 10);
    }

    /**
     * Handles `mouseleave` event for grid view image containers.
     * Initiates a timeout to hide the popup if no other image container is hovered.
     */
    function gridContainerMouseLeave() {
        if (currentView !== "grid") return; // Only process if in grid view

        this.dataset.hovered = "false"; // Mark container as no longer hovered
        mouseOverImageContainer = false; // Mouse is no longer over an image container

        // Don't hide immediately, give time to move to another container
        if (popupHideTimeout) clearTimeout(popupHideTimeout);
        popupHideTimeout = setTimeout(() => {
            // Check if ANY grid image container is still hovered before hiding the popup
            const anyHovered = Array.from(
                document.querySelectorAll(".grid-view .project-image-container")
            ).some((c) => c.dataset.hovered === "true");
            if (!anyHovered) {
                hidePopup();
                currentHoveredItem = null; // Reset current hovered item
            }
        }, 150);
    }

    /**
     * Displays the image preview popup.
     * Uses GSAP for fade-in animations.
     * @param {string} src The URL of the image to display in the popup.
     */
    function showPopup(src) {
        if (!src) return; // Don't show if no source is provided

        const {gsap} = window;
        if (!gsap) return; // Ensure GSAP is available

        // If popup is currently hidden
        if (popupOverlay.style.display !== "flex" || !isPopupVisible) {
            isPopupVisible = true;
            popupImage.src = src; // Set the image source
            popupOverlay.style.display = "flex"; // Make overlay visible
            popupOverlay.classList.add("active"); // Add active class to enable pointer events

            // Animate overlay opacity and image opacity
            gsap.fromTo(
                popupOverlay,
                {opacity: 0},
                {opacity: 1, duration: 0.5, ease: "power2.out"}
            );
            gsap.fromTo(
                popupImage,
                {opacity: 0},
                {opacity: 1, duration: 0.5, ease: "power2.out", delay: 0.1}
            );
        } else if (popupImage.src !== src) {
            // If popup is already open but image needs to change (faster transition)
            gsap.to(popupImage, {
                opacity: 0,
                duration: 0.1, // Faster fade out
                ease: "power2.out",
                onComplete: () => {
                    popupImage.src = src; // Change image source
                    gsap.to(popupImage, {
                        opacity: 1,
                        duration: 0.1, // Faster fade in
                        ease: "power2.out"
                    });
                }
            });
        }
    }

    /**
     * Hides the image preview popup.
     * Uses GSAP for fade-out animations.
     */
    function hidePopup() {
        // Don't hide if we're in the middle of a rapid interaction (e.g., quickly moving mouse)
        if (Date.now() - lastInteractionTime < 100) return;

        const {gsap} = window;
        if (!gsap) return;

        isPopupVisible = false; // Update popup visibility flag

        // Animate overlay opacity to 0
        gsap.to(popupOverlay, {
            opacity: 0,
            duration: 0.5,
            ease: "power2.out",
            onComplete: () => {
                popupOverlay.style.display = "none"; // Hide overlay after animation
                popupOverlay.classList.remove("active"); // Remove active class to disable pointer events
                popupImage.src = ""; // Clear image source
            }
        });
    }

    /**
     * Toggles between list and grid views for project display.
     * Uses GSAP Flip plugin for smooth layout transitions.
     * @param {string} viewType The target view type ('list' or 'grid').
     */
    function toggleView(viewType) {
        // Prevent toggling if already in the target view or an animation is in progress
        if (currentView === viewType || isAnimating) return;
        isAnimating = true; // Set animation flag

        // Hide popup during view transition for a cleaner look
        hidePopup();
        currentHoveredItem = null;
        mouseOverImageContainer = false;

        // Clear any pending popup show/hide timeouts
        if (popupHideTimeout) {
            clearTimeout(popupHideTimeout);
            popupHideTimeout = null;
        }
        if (popupShowTimeout) {
            clearTimeout(popupShowTimeout);
            popupShowTimeout = null;
        }

        const {gsap} = window;
        const Flip = window.Flip;

        // Fallback to basic toggle if GSAP or Flip plugin is not available
        if (!gsap || !Flip) {
            projectsContainer.classList.remove(`${currentView}-view`);
            projectsContainer.classList.add(`${viewType}-view`);
            toggleButtons.forEach((btn) => {
                btn.classList.toggle("active", btn.dataset.view === viewType);
            });
            currentView = viewType;
            isAnimating = false;
            attachHoverEvents(); // Re-attach events for fallback
            return;
        }

        // Select elements whose positions/transforms will be animated by Flip
        const projectItems = document.querySelectorAll(".project-item");
        const titleElements = document.querySelectorAll(".project-title");
        const yearElements = document.querySelectorAll(".project-year");
        const imageContainers = document.querySelectorAll(".project-image-container");
        const imageElements = document.querySelectorAll(".project-image");

        // When transitioning to list view, temporarily show image containers
        // for Flip to capture their state before hiding them by CSS
        if (viewType === "list") {
            imageContainers.forEach((container) =>
                container.classList.add("transitioning-to-list")
            );
        }

        // Capture the current state of elements before changing the layout
        const state = Flip.getState([
            projectItems,
            titleElements,
            yearElements,
            imageContainers
        ]);

        // Change the layout by updating class names
        projectsContainer.classList.remove(`${currentView}-view`);
        projectsContainer.classList.add(`${viewType}-view`);
        toggleButtons.forEach((btn) => {
            btn.classList.toggle("active", btn.dataset.view === viewType);
        });
        currentView = viewType; // Update current view

        // If transitioning to grid view, ensure image containers are visible and prepare images for animation
        if (viewType === "grid") {
            gsap.set(imageContainers, {
                display: "block",
                visibility: "visible",
                opacity: 1
            });
            gsap.set(imageElements, {clipPath: "inset(100% 0% 0% 0%)"}); // Prepare images to slide up
        }

        // Run the Flip animation
        Flip.from(state, {
            duration: 1, // Animation duration
            ease: "power2.out", // Easing function
            absolute: true, // Keep elements in absolute position during transition
            nested: true, // Handle nested elements correctly
            // Callback for elements entering the new state (e.g., new elements appearing)
            onEnter: (elements) =>
                gsap.fromTo(
                    elements,
                    {opacity: 0},
                    {opacity: 1, duration: 0.5, ease: "power2.out"}
                ),
            // Callback for elements leaving the old state (e.g., elements disappearing)
            onLeave: (elements) =>
                gsap.to(elements, {opacity: 0, duration: 0.5, ease: "power2.out"}),
            onComplete: () => {
                // After Flip animation completes, animate images based on the new view
                viewType === "grid" ? animateImagesIn() : animateImagesOut();
                // Re-attach hover events as element positions and visibility have changed
                attachHoverEvents();
            }
        });
    }

    /**
     * Animates images into view for the grid layout using clip-path.
     */
    function animateImagesIn() {
        const {gsap} = window;
        if (!gsap) {
            isAnimating = false;
            return;
        }

        const imageElements = document.querySelectorAll(".project-image");
        gsap.to(imageElements, {
            clipPath: "inset(0% 0% 0% 0%)", // Reveal image fully
            duration: 1,
            ease: "power2.out",
            stagger: 0.06, // Stagger animation for each image
            onComplete: () => {
                isAnimating = false; // Reset animation flag
                attachHoverEvents(); // Re-attach hover events after animation completes
            }
        });
    }

    /**
     * Animates images out of view for the list layout using clip-path.
     */
    function animateImagesOut() {
        const {gsap} = window;
        if (!gsap) {
            isAnimating = false;
            return;
        }

        const imageElements = document.querySelectorAll(".project-image");
        const imageContainers = document.querySelectorAll(".project-image-container");
        gsap.to(imageElements, {
            clipPath: "inset(0% 0% 100% 0%)", // Hide image from bottom
            duration: 1,
            ease: "power2.out",
            stagger: 0.06,
            onComplete: () => {
                // After images are hidden, remove the transitional class and set display to none
                imageContainers.forEach((container) =>
                    container.classList.remove("transitioning-to-list")
                );
                gsap.set(imageContainers, {display: "none", visibility: "hidden"});
                isAnimating = false; // Reset animation flag
                attachHoverEvents(); // Re-attach hover events after animation completes
            }
        });
    }
</script>
</body>
</html>
